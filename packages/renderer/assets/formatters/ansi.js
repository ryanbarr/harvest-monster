import { formatPrice } from "../../utils/formatPrice";
import { parsePrice } from "../../utils/parsePrice";

export default {
  key: "ansi",
  name: "ANSI",
  prefix: ({
    currentLeagueName,
    username,
    customNotes,
    exchangeRate,
    includeExchangeRate,
    willingToStream,
  }) => {
    let post = "```ansi\n";

    post += `[0m[4;33mWTS ${currentLeagueName}`;

    if (username && username.trim() !== "") {
      post += `[0m[0;32m - IGN: ${username}`;
    }

    post += `[0;30m | Generated by [0;36mHarvest[0;34mMonster\n`;

    // Custom Notes
    if (customNotes.trim() !== "") {
      post += `[1;34m${customNotes}\n`;
    }

    // Exchange Rate
    if (includeExchangeRate) {
      post += `[1;32m* Exchange Rate: [0m${exchangeRate}c to 1ex\n`;
    }

    // Willing to Stream
    if (willingToStream) {
      post += `[1;37m* Can stream if requested.\n`;
    }

    post += `[0;30m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n`;

    return post;
  },
  craft: (craft, { maxCraftLength }) => {
    let post = "";
    const quantityLengthAdjustment = `${craft.quantity}`.length - 1;
    let bufferLength =
      maxCraftLength - craft.name.length + 3 - quantityLengthAdjustment;

    const buffer = Array.from(Array(bufferLength), () => "").join(" ");

    if (craft.quantity === 0) {
      post += "~~";
    }

    post += `[0;36m${craft.quantity}x[0m[0;30m |[1;37m ${craft.name}${buffer} [0;30m |[0;34m[${
      craft.level > 0 ? craft.level : "83"
    }] [0;33m<${formatPrice(parsePrice(craft.displayPrice))}>`;

    if (craft.quantity === 0) {
      post += "~~";
    }

    post += "\n";

    return post;
  },
  suffix: () => "```",
};
